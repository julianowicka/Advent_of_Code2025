
const input2 = `
......................................................................S......................................................................
.............................................................................................................................................
......................................................................^......................................................................
.............................................................................................................................................
.....................................................................^.^.....................................................................
.............................................................................................................................................
....................................................................^...^....................................................................
.............................................................................................................................................
...................................................................^.^.^.^...................................................................
.............................................................................................................................................
..................................................................^.^.....^..................................................................
.............................................................................................................................................
.................................................................^.^.^.^.^.^.................................................................
.............................................................................................................................................
................................................................^.^.......^.^................................................................
.............................................................................................................................................
...............................................................^.^.^...^.^.^.^...............................................................
.............................................................................................................................................
..............................................................^.^.^.^.^.^.^...^..............................................................
.............................................................................................................................................
.............................................................^.^.^...^.......^.^.............................................................
.............................................................................................................................................
............................................................^.^.....^.^.^.^.^.^.^............................................................
.............................................................................................................................................
...........................................................^.^...^.^...^.^...^...^...........................................................
.............................................................................................................................................
..........................................................^.^...^...^...^.^...^.^.^..........................................................
.............................................................................................................................................
.........................................................^.^.^.^.^.^.....^.^.^...^.^.........................................................
.............................................................................................................................................
........................................................^.^...^...^.^...^.^.^.^...^.^........................................................
.............................................................................................................................................
.......................................................^.^.^...^.^...^.^...^.^.^.....^.......................................................
.............................................................................................................................................
......................................................^.^...^...^.^.^.^.^.^...^.^.^...^......................................................
.............................................................................................................................................
.....................................................^.^.^.^.^.^...^.^.^...^.........^.^.....................................................
.............................................................................................................................................
....................................................^...^...^.....^.....^.^.^.^.....^.^.^....................................................
.............................................................................................................................................
...................................................^...^.^.^.......^...^.....^.^.^...^.^.^...................................................
.............................................................................................................................................
..................................................^.....^.^.^.^.^.^.^.^.^...^...^.^.^.^...^..................................................
.............................................................................................................................................
.................................................^.^.^...^.^.^.....^.^.^.^.....^...^.^.^.^.^.................................................
.............................................................................................................................................
................................................^.^.....^.^...^.^.^...^.....^.^.^.^.^.^...^.^................................................
.............................................................................................................................................
...............................................^.^.^.^.^.^.^...^.^...^.^...^.^...^.^.^.^.^.^.^...............................................
.............................................................................................................................................
..............................................^.^.^.^.^.^...^...^...^...^.^.....^.^.^.^.^...^.^..............................................
.............................................................................................................................................
.............................................^...^.^...^.^.^.......^.^...^.^.^.^.^.^...^.^.....^.............................................
.............................................................................................................................................
............................................^...^.^...^.^.^.....^.....^.^.^.^.^.....^.^.....^...^............................................
.............................................................................................................................................
...........................................^.^.^.^.^.^.^.^.^.....^.^.^.^.^...^...^.^.^...^.....^.^...........................................
.............................................................................................................................................
..........................................^.^...^.^.^.^.^.^.^...^...^.^.^...^.^.^.^.^.^...^...^.^.^..........................................
.............................................................................................................................................
.........................................^.^...^...^.......^.^.^.^.^.....^.^.^...^.^.^.^.^.^...^.^.^.........................................
.............................................................................................................................................
........................................^.....^.^.....^.^...^.^...^.^.^.^...........^...^.^...^...^.^........................................
.............................................................................................................................................
.......................................^.^.^...^.^.^.^.^.^...^.^...^.^.........^.^.^.^.^.^.^.....^.^.^.......................................
.............................................................................................................................................
......................................^.....^.^...........^.^.^.^.......^...^.^.^...^.......^.......^.^......................................
.............................................................................................................................................
.....................................^.^.^.....^.^.^.^.^.....^...^.^.^.^.^...^.^...^.^...^...^...^...^.^.....................................
.............................................................................................................................................
....................................^.^.....^...^.^...^.^.....^.^.^.^.^...^.^...^.^...^.^.^.^...^...^...^....................................
.............................................................................................................................................
...................................^...^.^.^.^...^.^...^...^.......^.^.^.^.....^.^.^...^.^...^.^...^.^...^...................................
.............................................................................................................................................
..................................^...^.......^.^.^.^.^.......^.^.^.............^...^.....^...^.^...^.^.^.^..................................
.............................................................................................................................................
.................................^.^.^.^.......^.....^.^.^...^.....^.....^.^.^.^...^.^...^.^.^...^.......^.^.................................
.............................................................................................................................................
................................^...^.^.^...^.......^...^.^...^...^.^.^.^.^.^.^.....^.^...^.^...^.^...^.^...^................................
.............................................................................................................................................
...............................^...^.....^.^.^...^...........^.^...^.........^.^.^.^.^...^.^.^.^.^...^.^.^.^.^...............................
.............................................................................................................................................
..............................^.^...^.^.......^.....^.^.^.^...^.^.^...^.^...^.^.^...^.^.^.....^...^.^.^...^...^..............................
.............................................................................................................................................
.............................^.^.^...^.^.^...^.^.^.^.^.^.....^...^.^.^...^.....^.^.^.^.^...^...^.^.^.^.^.^.....^.............................
.............................................................................................................................................
............................^.^.^...^.^.^...^.^.....^.^...^.^.^.^...^...^...^.^.^.^.^.^...^.......^.^.^.^.^.^.^.^............................
.............................................................................................................................................
...........................^.^.^.^.^...^...^.^.^.^...^.^.........^.^.^...^.....^.^.^.^...^.^...^.^.....^...^.^.^.^...........................
.............................................................................................................................................
..........................^...^...^.^.^.^.^.^.^.^.^.^.^...^...^...^.^.^.^.^...^.......^.^...^.^.^.^.^.....^.^...^.^..........................
.............................................................................................................................................
.........................^.^...^.^.^.^.^.^...^...^...^.....^...^.^.^.^...^.....^.^...^.^...^...^...^.^.^.^.^...^...^.........................
.............................................................................................................................................
........................^.^...^...^.^...^.^.^.^.^...^.......^...^.^.....^.^.^.....^...^.^.^.^.^.^.^...^.^...^...^.^.^........................
.............................................................................................................................................
.......................^.^.^.^.^.^.^...^.......^...^.^.^.^.^.^...^.^.^...........^.^.^.^...^.^.....^.^.^.^...^.^.^...^.......................
.............................................................................................................................................
......................^.^.....^.^...^.^.....^.^.^...^.^.^.^.^.^...^.^.....^.....^...^.^.^.^.^.^.......^.^.^.^...^.^.^.^......................
.............................................................................................................................................
.....................^.^.^...^.^.^.....^.^.^.^...^...^.^.^.^.^.^.^.^.^.^.^...^.^.........^.^.^.^.^.^.^...^.....^...^...^.....................
.............................................................................................................................................
....................^.......^...^.^.^.^.............^.^.^.^.^...^.^.^.^.^.^.^.^.^.^...^.^.^.^.^.......^...^.^.^.^.^.^.^.^....................
.............................................................................................................................................
...................^.^.^.^.^.............^.^.^.^.^.^.^.^...^.^.^.^...^.^.^.........^.^...^...^.^.^...^.^.^.^...^.^.^...^.^...................
.............................................................................................................................................
..................^...^.^.^...^.^.^...^.^.^.....^.^.^.^.^.^.^.^...^...........^.^.^...^.....^...^.^.^.......^.^.....^.^.^.^..................
.............................................................................................................................................
.................^...^.^...^.....^.^.^...^.^.^.^...^.^.^...^...^.^.^.^.^.^.^.....^.^.^.....^...^...^.^.^...^.^...^.^...^...^.................
.............................................................................................................................................
................^.^.^.^.^.^.^.^...^.......^.^.^.....^.^.^...^.....^.^...^.^.^.......^.^.^.^...^.....^.^...^.^.^.^.......^...^................
.............................................................................................................................................
...............^.^.^.^...^...^.^.^.....^.^.^.^...^.^.^.^.^.^...^.^.^.^...^.^...^.^.^.......^.^.^.^...^.^.^.^.^.^...^.^.^...^.^...............
.............................................................................................................................................
..............^.^...^...^...^...^.^.^.^.^.......^.^.^.^.^...^.....^.^.^.^.......^.^.^.^.^.^.^.^.^...^...^.^.^.^.^.^...^.^...^.^..............
.............................................................................................................................................
.............^.^...^.^.^...^...^.......^.....^.^...^.......^.^.^.^...^.^.^.^...^.^.^.......^.^.......^.^...^.^.^.^.^.^.^.^.^.^.^.............
.............................................................................................................................................
............^.^...^.^.....^.^.^...^.^...^.^.^.......^.^.^.^.^.^.....^...^.....^.^.^...^.^...^...^.^.^.^.......^.......^.^.^.^.^.^............
.............................................................................................................................................
...........^.......^...^...^.....^.^...^.^...^...........^.^.^.^...^.......^...^.^.^.....^.^.....^.....^.^...^.^.^.^.^.^.^.....^.^...........
.............................................................................................................................................
..........^.....^.^.....^.^.^.^.^...^.^...^.^.^.^.^.^.^.^...^.^...^...^.^.^.^.^...^.^.....^.^...^...^...^.....^.^.^.^.^.^.^.^.^.^.^..........
.............................................................................................................................................
.........^.^.^.^.^...^.^...^.^.^...^.^.^...^.^.^.^.^.^.^.^...^.^.^.^.^...^.^.^...^.^...^.^.^.^.^...^...^.^.^.^.....^...^.....^.^.^.^.........
.............................................................................................................................................
........^.^.^...^.^.^.^.^.^.^.^.^.^.....^.....^.^.^.^.^.^...^.^.^.^.^.^.^.^.^.^.....^.^.....^.^.....^.....^...^...^.....^...^.......^........
.............................................................................................................................................
.......^.^.^.^.^.^.....^.^.^.^.^.^.^...^.^...^.....^.^...^.^.^.^.^...^...^.^.^.^.^.^.....^.^...^.....^.^.^.^.^.^.^.^.^...^.^.^...^...^.......
.............................................................................................................................................
......^.^...^.^...^.^.^.^...^...^...^.^...^.......^.^...^.^.^.....^.^.^.^.^.^...^.^...^...^.^...^.^.^.^.^.^.^.^.......^.^.^...^...^...^......
.............................................................................................................................................
.....^.^.^.^.^.^.^.....^.....^.^...^...^.^.^...^...^.^...^.^.^.^...^.^.^.^.^.^.^.....^.^.^...^.^.^.^.......^...^.^.......^.^.^.........^.....
.............................................................................................................................................
....^...^.^.^.^...^.....^...^...^.^.^.^.^.^.^.......^.^.^.^.^.^...^.^.....^.^...^.^.......^.^...^...^.^.^.^...^.^.^.^.......^.^.^.^...^.^....
.............................................................................................................................................
...^.^...^...^.^.^...^.^.^.^.^.^.^.^.^.^.^.^.^.....^.^.^.^.^.^...^...^.^...^.....^.^.....^.^.^...^.^.^.^.^...........^...^...^.^.^.....^.^...
.............................................................................................................................................
..^...........^.^.^.^.^.^.....^...^.^.^.^.^...^.^...^.^.^.^.^.^...^.^...^.^.^...^...^...^.^.^.^.^.^.^...^.^.....^.^.^.^.^.^.^.^.^.^.^.^.^.^..
.............................................................................................................................................
.^...^...^.^.........^...^.^.^.....^...^...^.^.^.^.^...^.^.^.^.^...^.........^.^...^.^.^...^.^.^.^.^...^.^.^.^.^.^.^.....^.....^.....^.^.^.^.
.............................................................................................................................................
`;
function solvePartTwo() {
    const grid = input2.split(/\r?\n/).filter(line => line.trim().length > 0);
    
    if (grid.length === 0) {
        console.error("Error: Input is empty.");
        return;
    }

    const height = grid.length;
    const width = grid[0].length;

    let currentTimelines = new Map<number, number>();
    let startRow = -1;

    for (let y = 0; y < height; y++) {
        const x = grid[y].indexOf("S");
        if (x !== -1) {
            currentTimelines.set(x, 1);
            startRow = y;
            break;
        }
    }

    if (startRow === -1) {
        return;
    }

    for (let y = startRow + 1; y < height; y++) {
        const nextTimelines = new Map<number, number>();
        const currentRowStr = grid[y];

        for (const [x, count] of currentTimelines.entries()) {
            
            if (x >= currentRowStr.length) continue;

            const char = currentRowStr[x];

            if (char === "^") {
                if (x - 1 >= 0) {
                    const currentLeft = nextTimelines.get(x - 1) || 0;
                    nextTimelines.set(x - 1, currentLeft + count);
                }

                if (x + 1 < width) {
                    const currentRight = nextTimelines.get(x + 1) || 0;
                    nextTimelines.set(x + 1, currentRight + count);
                }
            } else {
                const currentStraight = nextTimelines.get(x) || 0;
                nextTimelines.set(x, currentStraight + count);
            }
        }

        currentTimelines = nextTimelines;

        if (currentTimelines.size === 0) {
            break;
        }
    }

    let totalTimelines = 0;
    for (const count of currentTimelines.values()) {
        totalTimelines += count;
    }

    console.log(`Total active timelines: ${totalTimelines}`);
}

solvePartTwo();